{% extends 'base.html' %}
{% load static %}
{% load cart_tags %}
{% block menu %}
{% endblock %}
{% block body_tag %}onunload="window.opener.location.reload(){% endblock %}
{#{% block jumbotron %}<h2 class="page-header">{{ object.block_num }}</h2><br>#}
{#    {% for item in slab_list %}#}
{#        {{ item.thickness }}#}
{#        厚度/{{ item.part_count }}#}
{#        夹/ {{ item.block_pics }}#}
{#        件/ {{ item.quantity }}#}
{#        m2#}
{#    {% endfor %}#}
{#{% endblock %}#}

{% block main %}
    <div style="height:60px"></div>
    <form method="post" id="slab_form" action="{% url 'cart:add' %}">
        {% for item in slab_list %}

            <ul class="nav nav-tabs">
                {% for part_key ,part_value in item.part_num.items %}
                    <li {% if forloop.first %} class="active" {% endif %}><a
                            {% if forloop.first %}aria-expanded="true"{% endif %}
                            data-toggle="tab"
                            href="#{{ item.thickness|slugify }}{{ part_key }}">
                        {{ part_key }}#夹</a>
                    </li>
                {% endfor %}
            </ul>

        {% endfor %}
        <div class="tab-content">
            {% for slabs in slab_list %}

                {#            <div id="{{ slabs.thickness|slugify }}">#}
                {#                <h2 class="page-header">{{ slabs.thickness }}#}
                {#                    厚度/{{ slabs.part_count }}#}
                {#                    夹/ {{ slabs.block_pics }}#}
                {#                    件/ {{ slabs.block_m2 }}#}
                {#                    m2#}
                {#                    <small class="pull-right">#}
                {#                        <div class="checkbox btn btn-default btn-sm">#}
                {#                            <label>#}
                {#                                <input type="checkbox"#}
                {#                                       id="{{ slabs.thickness|slugify }}{{ part_key }}_all"#}
                {#                                       onclick="select_all(this.id, this.checked)">全选/不选#}
                {#                            </label>#}
                {#                        </div>#}
                {#                    </small>#}
                {#                </h2>#}


                {% for part_key ,part_value in slabs.part_num.items %}

                    <div role="tabpanel"
                         class="tab-pane {% if forloop.first %} active{% endif %}"
                         id="{{ slabs.thickness|slugify }}{{ part_key }}">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <div class="panel-title">{{ part_key }}#
                                    夹/ {{ part_value.part_pics }}
                                    件/ {{ part_value.part_m2 }} m2
                                    <div class="pull-right">
                                        {% if limits.checkbox %}<input type="checkbox"
                                               class=" btn btn-default btn-sm"
                                               id="{{ slabs.thickness|slugify }}{{ part_key }}_all"
                                               onclick="select_all(this.id, this.checked)">
                                        <a class="btn btn-link"
                                           id="{{ slabs.thickness|slugify }}{{ part_key }}_reverse"
                                           onclick="select_reverse(this.id)">反选
                                        </a>{% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="panel-body">
                                <table class="table">
                                    <tr>
                                        <th width="10%">选择</th>
                                        <th width="15%">序号</th>
                                        <th width="55%">规格</th>
                                        <th>m2</th>
                                    </tr>
                                    {% for slab in part_value.slabs %}
                                        <tr id="{{ slab.id }}" class="clickable-row" onclick="select(this.id)">
                                            <td>
                                                {% if slab.id not in has_booking_ids_list %}{% if limits.checkbox %}<input type="checkbox" name="check_box_list"
                                                       onchange="sum_m2()"
                                                       {% if slab.id|stringformat:"i" in slab_ids %}checked="checked"{% endif %}
                                            {% if slab.id in has_booking_ids_list %} disabled {% endif %}
                                                    value="{{ slab.id }}">{% endif %}{% endif %}
                                            </td>
                                            <td>{{ slab.line_num }}</td>
                                            <td>{{ slab }}</td>
                                            <td id="{{ slab.id }}m2">{{ slab.m2 }}</td>

                                        </tr>
                                    {% endfor %}
                                </table>
                            </div>
                        </div>
                    </div>
                {% endfor %}

            {% endfor %}

        </div>
        <div style="height:20px "></div>
        <input type="hidden" name="path" value="{{ request.path }}">
        <input type="hidden" name="block_num" value="{{ object.block_num }}">
        <input type="hidden" name="thickness" value="{{ object.thickness }}">
        {% if key_value %}{% else %}<input type="hidden" name="key" value="current_order">{% endif %}
        <input type="hidden" name="block"
               value="{% ifequal object.block_type 'otw' %}1{% else %}0{% endifequal %}">
        {% csrf_token %}
    </form>
    <div class="navbar navbar-fixed-top" style="background-color: #f5f5f5">
        <ul class="list-unstyled">
            {% if limits.checkbox %}<li><input class="btn btn-primary btn-block" type="submit"
                       value="添加选择到项目" form="slab_form"></li>{% endif %}
            <li  style="padding-left: 20px">
                <ul class="list-unstyled">
                    <li><h3>{{ object.block_num }}</h3>
                    </li>
                    <li>
                        <ul class="list-inline">
                            {% for item in slab_list %}

                                <li>{{ item.thickness }}
                                    厚度
                                </li>
                                <li>{{ item.part_count }}
                                    夹
                                </li>
                                <li>{{ item.block_pics }}
                                    件
                                </li>
                                <li>{{ item.quantity }}m2
                                </li>
                                <li>
                                    {% if limits.checkbox %}<input type="checkbox"
                                           id="{{ item.thickness|slugify }}{{ part_key }}_all"
                                           onclick="select_all(this.id, this.checked)">全选/不选{% endif %}
                                </li>
                            {% endfor %}

                        </ul>

                    {% if limits.checkbox %}<li>
                        <ul class="list-inline" id="selected_info">
                            <li name="pics">目前已勾选:<b>pics</b>件</li>
                            <li name="m2"><b>m2</b>m2</li>
                        </ul>
                    </li>{% endif %}
                    </li>
                </ul>
            </li>

        </ul>
    </div>
    <script src="{% static "js/myJS.js" %}"></script>
{% endblock %}
{% block domready %}
    sum_m2()
{% endblock %}


<div role="tabpanel">
    <div>
        {#            <div class="pull-right">{% show_cart_info %}</div>#}

        {% for item in slab_list %}
            <div>
                <a href="#{{ item.thickness|slugify }}">{{ item.thickness }}
                    厚度/{{ item.part_count }}
                    夹/ {{ item.block_pics }}
                    件/ {{ item.block_m2 }}
                    m2</a>
                <div class="nav nav-tabs">
                    {% for part_key ,part_value in item.part_num.items %}
                        <li><a data-toggle="tab"
                               href="#{{ item.thickness|slugify }}{{ part_key }}">{{ part_key }}#
                            夹/ {{ part_value.part_pics }}
                            件/ {{ part_value.part_m2 }} m2</a>
                        </li>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}
        <div class="pull-right">目前已勾选:
            <ul id="selected_info">
                <li name="pics"><b>pics</b>件</li>
                <li name="m2"><b>m2</b>m2</li>
            </ul>
        </div>

    </div>
</div>